<html>
    <head>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">
        <link rel="stylesheet" href="static/css/index.css">
        <script
            src="https://code.jquery.com/jquery-3.4.1.min.js"
            integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
            crossorigin="anonymous"
        ></script>
        <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>

    </head>

    <body>
        <div class="" id="stripe">
            <div class="ui container eight column vertically padded stackable grid" id="header">
                <div class="row">
                    <div class="center aligned middle aligned column">
                        <img src="https://www.rle.mit.edu/cb/wp-content/uploads/2019/07/ccrg_logo_transparent_small.2.png"
                        />
                    </div>
                    <div class="ten wide large screen only column"></div>
                    <div class="center aligned middle aligned column">
                        <a onclick="displayCalc('calc-avs')">AVS Calc</a>
                    </div>
                    <div class="center aligned middle aligned column">
                        <a onclick="displayCalc('calc-2')">Calc 2</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="ui container" id="content">
            <div class="calc" id="calc-avs">
                <div class="ui centered">
                    <h1 id="title">Aortic Stenosis Calculator</h4>
                </div>
                <br />

                <form action="/as" method="POST" onsubmit="submitAsync(event, this)">
                    <div class="ui centered vertically divided equal width stackable grid">
                        <div class="two column row">
                            <div class="left aligned middle aligned column">
                                <label class="">Transvalvular flow rate</label>
                            </div>
                            <div class="right aligned middle aligned column">
                                <div class="ui right labeled fluid input">
                                    <input required
                                        oninvalid="this.setCustomValidity('Please provide transvalvular flow rate.')"
                                        oninput="this.setCustomValidity('')"
                                        type="number"
                                        step=.01
                                        name="tFlow"
                                    />
                                    <div class="ui label">mL/s</div>
                                </div>
                            </div>
                        </div>

                        <div class="two column row">
                            <div class="left aligned middle aligned column">
                                <label class="">Mean pressure gradient across aortic valve</label>
                            </div>
                            <div class="right aligned middle aligned column">
                                <div class="ui right labeled fluid input">
                                    <input required
                                        oninvalid="this.setCustomValidity('Please provide patient\'s pressure.')"
                                        oninput="this.setCustomValidity('')"
                                        type=number
                                        step=.01
                                        name="pressure"
                                    />
                                    <div class="ui label">mmHg</div>
                                </div>
                            </div>
                        </div>

                        <div class="two column row">
                            <div class="left aligned middle aligned column">
                                <label class="">Aortic valve area</label>
                            </div>
                            <div class="right aligned middle aligned column">
                                <div class="ui right labeled fluid input">
                                    <input required
                                        oninvalid="this.setCustomValidity('Please provide patient\'s valve area.')"
                                        oninput="this.setCustomValidity('')"
                                        type=number
                                        step=.01
                                        name="area"
                                    />
                                    <div class="ui label"> cm<sup>2</sup></div>
                                </div>
                            </div>
                        </div>

                        <div class="two column row">
                            <div class="left aligned middle aligned column">
                                <label class="">Congestive heart failure (CHF) at baseline</label>
                            </div>
                            <div class="right aligned middle aligned column">
                                <div class="ui radio checkbox chf_baseline" style="">
                                    <input
                                        required
                                        oninvalid="this.setCustomValidity('Please provide baseline CHF.')"
                                        oninput="resetRadioValidity()"
                                        type="radio"
                                        name="chf_baseline"
                                        id="yn3-off"
                                        value="false"
                                    />
                                    <input
                                        required
                                        oninvalid="this.setCustomValidity('Please provide baseline CHF.')"
                                        oninput="resetRadioValidity()"
                                        type="radio"
                                        name="chf_baseline"
                                        id="yn3-on"
                                        value="true"
                                    />
                                </div>
                                <div class="two ui buttons">
                                    <label for="yn3-off" class="ui button fluid opaque uncheck chf_baseline" onclick="markButton(event, 'chf_baseline');">No</label>
                                    <label for="yn3-on" class="ui button fluid opaque check chf_baseline" onclick="markButton(event, 'chf_baseline');">Yes</label>
                                </div>
                            </div>
                        </div>

                        <div class="two column row">
                            <div class="left aligned middle aligned column">
                                <label class="">Myocardial infarction (MI) at baseline</label>
                            </div>
                            <div class="right aligned middle aligned column">
                                <div class="ui radio checkbox mi_baseline" style="">
                                    <input
                                        required
                                        oninvalid="this.setCustomValidity('Please provide baseline MI.')"
                                        oninput="resetRadioValidity()"
                                        type="radio"
                                        name="mi_baseline"
                                        id="yn4-off"
                                        value="false"
                                    />
                                    <input
                                        required
                                        oninvalid="this.setCustomValidity('Please provide baseline MI.')"
                                        oninput="resetRadioValidity()"
                                        type="radio"
                                        name="mi_baseline"
                                        id="yn4-on"
                                        value="true"
                                    />
                                </div>
                                <div class="two ui buttons">
                                    <label for="yn4-off" class="ui button opaque uncheck mi_baseline" onclick="markButton(event, 'mi_baseline');">No</label>
                                    <label for="yn4-on" class="ui button opaque check mi_baseline" onclick="markButton(event, 'mi_baseline');">Yes</label>
                                </div>
                            </div>
                        </div>

                        <div class="two column row">
                            <div class="left aligned middle aligned column">
                                <label class="">Peripheral vascular disease (PVD) at baseline</label>
                            </div>
                            <div class="right aligned middle aligned column">
                                <div class="ui radio checkbox pvd_baseline">
                                    <input
                                        required
                                        oninvalid="this.setCustomValidity('Please provide baseline PVD.')"
                                        oninput="resetRadioValidity()"
                                        type="radio"
                                        name="pvd_baseline"
                                        id="yn5-off"
                                        value="false"
                                    />
                                    <input
                                        required
                                        oninvalid="this.setCustomValidity('Please provide baseline PVD.')"
                                        oninput="resetRadioValidity()"
                                        type="radio"
                                        name="pvd_baseline"
                                        id="yn5-on"
                                        value="true"
                                    />
                                </div>
                                <div class="two ui buttons">
                                    <label for="yn5-off" class="ui button opaque uncheck pvd_baseline" onclick="markButton(event, 'pvd_baseline');">No</label>
                                    <label for="yn5-on" class="ui button opaque check pvd_baseline" onclick="markButton(event, 'pvd_baseline');">Yes</label>
                                </div>
                            </div>
                        </div>

                        <div class="two column row">
                            <div class="left aligned middle aligned column">
                                <label class="">Left ventricular segmental wall motion abnormality</label>
                            </div>
                            <div class="right aligned middle aligned column">
                                <div class="ui radio checkbox wall_abnormality">
                                    <input
                                        required
                                        oninvalid="this.setCustomValidity('Please provide the motion abnormality.')"
                                        oninput="resetRadioValidity()"
                                        type="radio"
                                        name="wall_abnormality"
                                        id="yn6-off"
                                        value="false"
                                    />
                                    <input
                                        required
                                        oninvalid="this.setCustomValidity('Please provide the motion abnormality.')"
                                        oninput="resetRadioValidity()"
                                        type="radio"
                                        name="wall_abnormality"
                                        id="yn6-on"
                                        value="true"
                                    />
                                </div>
                                <div class="two ui buttons">
                                    <label for="yn6-off" class="ui button opaque uncheck wall_abnormality" onclick="markButton(event, 'wall_abnormality');">No</label>
                                    <label for="yn6-on" class="ui button opaque check wall_abnormality" onclick="markButton(event, 'wall_abnormality');">Yes</label>
                                </div>
                            </div>
                        </div>

                        <div class="two column row">
                            <div class="left aligned middle aligned column">
                                <label class="">Hyperlipidemia at baseline</label>
                            </div>
                            <div class="right aligned middle aligned column">
                                <div class="ui toggle checkbox hyperlipidemia_baseline">
                                    <input
                                        required
                                        oninvalid="this.setCustomValidity('Please provide baseline hyperlipidemia.')"
                                        oninput="resetRadioValidity()"
                                        type="radio"
                                        name="hyperlipidemia_baseline"
                                        id="yn7-off"
                                        value="false"
                                    />
                                    <input
                                        required
                                        oninvalid="this.setCustomValidity('Please provide the motion abnormality.')"
                                        oninput="resetRadioValidity()"
                                        type="radio"
                                        name="hyperlipidemia_baseline"
                                        id="yn7-on"
                                        value="true"
                                    />
                                </div>
                                <div class="two ui buttons">
                                    <label for="yn7-off" class="ui button opaque uncheck hyperlipidemia_baseline" onclick="markButton(event, 'hyperlipidemia_baseline');">No</label>
                                    <label for="yn7-on" class="ui button opaque check hyperlipidemia_baseline" onclick="markButton(event, 'hyperlipidemia_baseline');">Yes</label>
                                </div>
                            </div>
                        </div>

                        <div class="two column row">
                            <div class="left aligned middle aligned column">
                                <label class="">Chronic kidney disease (CKD) at baseline</label>
                            </div>
                            <div class="right aligned middle aligned column">
                                <div class="ui radio checkbox ckd_baseline">
                                    <input
                                        required
                                        oninvalid="this.setCustomValidity('Please provide baseline CKD.')"
                                        oninput="resetRadioValidity()"
                                        type="radio"
                                        name="ckd_baseline"
                                        id="yn8-off"
                                        value="false"
                                    />
                                    <input
                                        required
                                        oninvalid="this.setCustomValidity('Please provide baseline CKD.')"
                                        oninput="resetRadioValidity()"
                                        type="radio"
                                        name="ckd_baseline"
                                        id="yn8-on"
                                        value="true"
                                    />
                                </div>
                                <div class="two ui buttons">
                                    <label for="yn8-off" class="ui button opaque uncheck ckd_baseline" onclick="markButton(event, 'ckd_baseline');">No</label>
                                    <label for="yn8-on" class="ui button opaque check ckd_baseline" onclick="markButton(event, 'ckd_baseline');">Yes</label>
                                </div>
                            </div>
                        </div>

                        <div class="two column row">
                            <div class="left aligned middle aligned column">
                                <label class="">Posterior wall thickness</label>
                            </div>
                            <div class="right aligned middle aligned column">
                                <div class="ui right labeled fluid input">
                                    <input required
                                        oninvalid="this.setCustomValidity('Please provide patient\'s posterior wall thickness.')"
                                        oninput="this.setCustomValidity('')"
                                        type=number
                                        step=.01
                                        name="thickness"
                                    />
                                    <div class="ui label"> mm </div>
                                </div>
                            </div>
                        </div>

                        <div class="two column row">
                            <div class="left aligned middle aligned column">
                                <label class="">Aortic sinus diameter</label>
                            </div>
                            <div class="right aligned middle aligned column">
                                <div class="ui right labeled fluid input">
                                    <input required
                                        oninvalid="this.setCustomValidity('Please provide patient\'s aortic sinus diameter.')"
                                        oninput="this.setCustomValidity('')"
                                        type=number
                                        step=.01
                                        name="diameter"
                                    />
                                    <div class="ui label"> mm </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="result" class="ui large positive message hidden">
                    </div>

                    <input class="fluid ui button md-green" id="submit" type="submit" value="Submit" >
                    <div id="accept-modal" class="ui modal">
                        <div class="header">Please accept the Terms of Service</div>
                        <div class="scrolling content">
                            <p>Please read these Terms and Conditions carefully before clicking on the button at the end of this page. These are the Terms and Conditions upon which you will be permitted to enter and use MIT/MGH's Online Risk Calculator ("the Risk Calculator"). By clicking on the "Accept" button at the end of this page, you are agreeing to become bound by these Terms and Conditions. If you do not agree to these Terms and Conditions, click on the "Decline" button below.
                                <br><br>1. Ownership.
                                <br><br>The Risk Calculator is wholly owned by MIT/MGH (M/M).
                                <br><br>2. Copyright.
                                <br><br>All materials and content posted on this site are subject to copyrights owned by M/M. 
                                <br><br>3. Trademark
                                <br><br>The M/M name and logo, and all related product and service names, are M/M's proprietary trademarks and service marks, and may not be used by any other party without the prior express written permission of M/M. These names, trademarks, service marks, and logos may not be used in any advertising, publicity, or otherwise to indicate, suggest, or imply M/M sponsorship of or affiliation with any product or services, without M/M's prior express written permission.
                                <br><br>4. Disclaimer of Warranties.
                                <br><br>M/M, ON ITS OWN BEHALF AND ON BEHALF OF ALL OF ITS SERVICE PROVIDERS ASSOCIATED WITH THE RISK CALCULATOR (HEREINAFTER COLLECTIVELY REFERRED TO AS "M/M"), DISCLAIMS ANY AND ALL RESPONSIBILITY OR LIABILITY FOR THE ACCURACY, CONTENT, COMPLETENESS, LEGALITY, RELIABILITY, OPERABILITY, OR AVAILABILITY OF INFORMATION OR MATERIAL DISPLAYED IN THE RISK CALCULATOR RESULTS. M/M DISCLAIMS ANY RESPONSIBILITY FOR THE DELETION, FAILURE TO STORE, MISDELIVERY, OR UNTIMELY DELIVERY OF ANY INFORMATION OR MATERIAL. M/M DISCLAIMS ANY RESPONSIBILITY FOR ANY HARM RESULTING FROM DOWNLOADING OR ACCESSING ANY INFORMATION OR MATERIAL ON THE INTERNET THROUGH THE RISK CALCULATOR. THE RISK CALCULATOR, AND ALL MATERIALS, INFORMATION, PRODUCTS AND SERVICES INCLUDED IN THE RISK CALCULATOR ARE PROVIDED "AS IS," WITH NO WARRANTIES WHATSOEVER. M/M AND ITS LICENSORS EXPRESSLY DISCLAIM TO THE FULLEST EXTENT PERMITTED BY LAW ALL EXPRESS, IMPLIED, AND STATUTORY WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, AND NON-INFRINGEMENT OF PROPRIETARY RIGHTS. M/M AND ITS LICENSORS DISCLAIM ANY WARRANTIES REGARDING THE SECURITY, RELIABILITY, TIMELINESS, AND PERFORMANCE OF THE RISK CALCULATOR. M/M AND ITS LICENSORS DISCLAIM, ANY WARRANTIES FOR ANY INFORMATION OR ADVICE OBTAINED THROUGH THE RISK CALCULATOR.
                                <br><br>YOU UNDERSTAND AND AGREE THAT YOU DOWNLOAD OR OTHERWISE OBTAIN MATERIAL OR DATA THROUGH THE USE OF THE RISK CALCULATOR AT YOUR OWN DISCRETION AND RISK AND THAT YOU WILL BE SOLELY RESPONSIBLE FOR ANY DAMAGES TO YOUR COMPUTER SYSTEM OR LOSS OF DATA THAT RESULTS FROM THE DOWNLOAD OF SUCH MATERIAL OR DATA.
                                <br><br>SOME STATES OR OTHER JURISDICTIONS DO NOT ALLOW THE EXCLUSION OF IMPLIED WARRANTIES, SO THE ABOVE EXCLUSIONS MAY NOT APPLY TO YOU. YOU MAY ALSO HAVE OTHER RIGHTS THAT VARY FROM STATE TO STATE AND JURISDICTION TO JURISDICTION.
                                <br><br>5. Disclaimer of Liability.
                                <br><br>M/M is providing information and services on the Internet as a benefit and service in furtherance of its nonprofit, educational mission. THE USER ASSUMES ALL RESPONSIBILITY FOR, AND HOLDS M/M HARMLESS FROM ANY CLAIMS ARISING OUT OF, ITS USE OR MISUSE OF, OR INABILITY TO USE, THE RISK CALCULATOR, WHETHER SUCH CLAIM IS BASED ON WARRANTY, CONTRACT, OR TORT (INCLUDING NEGLIGENCE). UNDER NO CIRCUMSTANCES, INCLUDING BUT NOT LIMITED TO NEGLIGENCE, SHALL M/M OR ANYONE ELSE INVOLVED IN CREATING OR MAINTAINING THE RISK CALCULATOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, CONSEQUENTIAL, EXEMPLARY, OR PUNITIVE DAMAGES, OR LOST PROFITS THAT RESULT FROM THE USE OR MISUSE OF, OR INABILITY TO USE, THE RISK CALCULATOR, INCLUDING, BUT NOT LIMITED TO, RELIANCE BY A USER ON ANY INFORMATION OBTAINED VIA THE RISK CALCULATOR, OR THAT RESULT FROM MISTAKES, OMISSIONS, INTERRUPTIONS, DELETION OF FILES, VIRUSES, ERRORS, DEFECTS, OR ANY FAILURE OF PERFORMANCE, COMMUNICATIONS FAILURE, THEFT, DESTRUCTION OR UNAUTHORIZED ACCESS WITH RESPECT TO THE RISK CALCULATOR (INCLUDING SUCH DAMAGES INCURRED BY THIRD PARTIES). M/M IS NOT RESPONSIBLE FOR ANY TREATMENT OR OTHER MEDICAL DECISIONS MADE BY USERS BASED ON INFORMATION OBTAINED VIA THE RISK CALCULATOR, AND USER AGREES TO INDEMNIFY M/M AND HOLD M/M HARMLESS FROM ANY CLAIMS ARISING OUT OF SUCH DECISIONS.
                                <br><br>WITHOUT LIMITING THE FOREGOING, UNDER NO CIRCUMSTANCES SHALL M/M OR ITS LICENSORS BE HELD LIABLE FOR ANY DELAY OR FAILURE IN PERFORMANCE RESULTING DIRECTLY OR INDIRECTLY FROM ACTS OF NATURE, FORCES, OR CAUSES BEYOND ITS REASONABLE CONTROL, INCLUDING, WITHOUT LIMITATION, INTERNET FAILURES, COMPUTER EQUIPMENT FAILURES, TELECOMMUNICATION EQUIPMENT FAILURES, OTHER EQUIPMENT FAILURES, ELECTRICAL POWER FAILURES, STRIKES, LABOR DISPUTES, RIOTS, INSURRECTIONS, CIVIL DISTURBANCES, SHORTAGES OF LABOR OR MATERIALS, FIRES, FLOODS, STORMS, EXPLOSIONS, ACTS OF GOD, WAR, GOVERNMENTAL ACTIONS, ORDERS OF DOMESTIC OR FOREIGN COURTS OR TRIBUNALS, NON-PERFORMANCE OF THIRD PARTIES, OR LOSS OF OR FLUCTUATIONS IN HEAT, LIGHT, OR AIR CONDITIONING.
                                <br><br>IN STATES WHICH DO NOT ALLOW SOME OR ALL OF THE ABOVE LIMITATIONS OF LIABILITY, LIABILITY SHALL BE LIMITED TO THE GREATEST EXTENT ALLOWED BY LAW.
                                <br><br>6. Privacy Policy.
                                <br><br>The Risk Calculator does not collect personally identifiable information from users, such as name, physical address, email address, or individually identifiable health information. The Risk Calculator may collect limited non-personally identifying information your browser makes available whenever you visit a Web site. This log information may include your Internet Protocol address, browser type, browser language, the date and time of your query and one or more "cookies" that may uniquely identify your browser. A "cookie" is a small file containing a string of characters that is sent to your computer when you visit a website. We may use this information to operate, develop and improve the Risk Calculator. We do not extract personal information in this process nor do we provide this information to third parties. We also do not contact you based on information in your cookie file.
                                <br><br>Please note this Privacy Policy may change from time to time. We expect most such changes to be minor, but there may be changes that are more significant. Regardless, we will post those changes on this page and, if the changes are significant, we will also provide a more prominent notice.
                                <br><br>7. General.
                                <br><br>These Terms and Conditions constitute the entire agreement between the parties with respect to the Risk Calculator and supersede and replace all prior or contemporaneous understandings or agreements, written or oral, regarding such subject matter. Any waiver of any provision of the Terms and Conditions will be effective only if in writing and signed by M/M. These Terms and Conditions shall be governed and interpreted in accordance with the laws of the State of Massachusetts, applicable to contracts made and fully performed therein. If any provision of these Terms and Conditions is held by a court of competent jurisdiction to be contrary to law, that provision will be enforced to the maximum extent permissible and the remaining provisions will remain in full force and effect. M/M may modify these Terms and Conditions without notice.
                            </p>
                        </div>
                        <div class="actions">
                            <div class="ui black deny button">
                                Decline
                            </div>
                            <div class="ui positive right labeled icon button">
                                By proceeding, I accept the Terms and Conditions
                                <i class="checkmark icon"></i>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <div class="calc hidden" id="calc-2">
                <div class="ui centered">
                    <h1 id="title">Calc 2</h4>
                </div>
                <br />

                <form action="/rlrvi" method="POST" onsubmit="submitAsync(event, this)">
                </form>

            </div>

        <script type="text/javascript">
            function markButton(event, className) {
                // green to denote, disabled so cannot be clicked again
                $(".button." + className).removeClass("md-green");
                $(".button." + className).removeClass("disabled");
                $(event.target).addClass("md-green");
                $(event.target).addClass("disabled");
            }

            function resetRadioValidity(event) {
                var rad = document.querySelectorAll('input[type=radio]')
                rad.forEach(function(r) {
                    r.setCustomValidity('')
                });
            }

            function logTarget(event) {
                console.log(event.target.value);
            }

            function navToHomepage() {
                window.location.href = "http://imes.mit.edu/initiatives/mit-mgh/";
            }

            function submitAsync(event, form) {
                event.preventDefault();  // submit form asynchonously
                fetch(form.action, {
                    method: 'post',
                    body: new FormData(form),
                }).then(function(res) {
                    return res.json()
                }).then(function(json) {
                    console.log("RESPONSE")
                    console.log(json)
                    populateResult(json["yh_syn"]);
                    return json
                })
            }

            function resultRow(outcome, risk, lower, upper) {
                return "<p><span>" + outcome +
                    "</span><span>" + risk +
                    "</span><span>" + lower +
                    "</span><span>" + upper +
                    "</span></p>";
            }

            function populateResult(resultData) {
                $('#result').removeClass('hidden');
                var res = resultRow("Outcome", "Risk", "Lower 95% CI", "Upper 95% CI");
                Object.entries(resultData).forEach(function(key, val) {
                    res += resultRow(key, val[0], val[1], val[2])
                })
                $('#result').html(res)
            }

            // control calculator displays
            function displayCalc(calcId) {
                $('.calc').addClass('hidden');
                $('#' + calcId).removeClass('hidden');
            }

            // open modal on load
            $('.ui.modal')
                .modal({
                    closable: false,
                    onDeny: function () {
                        navToHomepage()
                        return true;
                    },
                    onApprove: function () {
                        return true;
                    },
                })
                .modal('show');
        </script>
    </body>
</html>
